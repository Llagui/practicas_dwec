<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeWars</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="header">Frutería San Andrés</div>
    <div id="main">
        <div id="products-section">
            <!-- Aquí es donde tienes que insertar los productos -->
        </div>
        <div id="cart-section">
            <!-- Espacio reservado para el carrito de la compra -->
        </div>
    </div>

    <script>
        let pagina = 1;
        //array con productos de la futeria
        let listProducts = [
            {
            id: '1000',
            product: 'Fresas de Huelva',
            price: 410,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/fresas.jpg',
            },
            {
            id: '1001',
            product: 'Kiwi amarillo',
            price: 245,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/kiwis.jpg',
            },
            {
            id: '1002',
            product: 'Manzana roja',
            price: 195,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/manzanas_rojas.jpg',
            },
            {
            id: '1003',
            product: 'Manzana verde',
            price: 170,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/manzanas_verdes.jpg',
            },
            {
            id: '1004',
            product: 'Melón',
            price: 135,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/melones.jpg',
            },
            {
            id: '1005',
            product: 'Naranja valenciana',
            price: 160,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/naranjas.jpg',
            },
            {
            id: '1006',
            product: 'Pera conferencia',
            price: 210,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/peras.jpg',
            },
            {
            id: '1007',
            product: 'Plátano',
            price: 260,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/platanos.jpg',
            },
            {
            id: '1008',
            product: 'Sandía',
            price: 115,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/sandias.jpg',
            },
            {
            id: '1009',
            product: 'Uva',
            price: 195,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/uvas.jpg',
            },
            {
            id: '1010',
            product: 'Aguacate',
            price: 415,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/aguacate.jpg',
            },
            {
            id: '1011',
            product: 'Cereza del Bierzo',
            price: 520,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/cereza.jpg',
            },
            {
            id: '1012',
            product: 'Granada',
            price: 310,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/granada.jpg',
            },
            {
            id: '1013',
            product: 'Limón',
            price: 155,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/limon.jpg',
            },
            {
            id: '1014',
            product: 'Nectarina',
            price: 180,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/nectarina.jpg',
            },
            {
            id: '1015',
            product: 'Piña',
            price: 320,
            image: 'https://vgonzalez165.github.io/dwec/assets/pr0414/imgs/pineapple.jpg',
            },
        
        ]
    
        let carro =[

        ];

        let divSeccionProductos = document.getElementById('products-section');

        let botonAtras = document.createElement('button');
        botonAtras.textContent  = "<";
        botonAtras.addEventListener('click',(e)=>{
            pagina > 1 ? pagina-- : pagina;
            texto.textContent = "Pagina " + pagina;
            createProducts();
        });

        let texto = document.createElement("span");
        texto.textContent = "Pagina " + pagina;

        let botonAlante = document.createElement('button');
        botonAlante.textContent  = ">";
        botonAlante.addEventListener('click',(e)=>{
            pagina < listProducts.length/8 ? pagina++ : pagina;
            texto.textContent = "Pagina " + pagina;
            createProducts();
        });

        let div = document.createElement("div");
        div.classList.add("barra");
        div.append(botonAtras);
        div.append(texto);
        div.append(botonAlante);
        divSeccionProductos.append(div);

        function createProduct(datos) {
            let divProducto = document.createElement('div');
            divProducto.classList.add("product");

            let foto = document.createElement("img");
            foto.setAttribute("src",datos['image']);
            foto.classList.add("product-foto");

            let divDatos = document.createElement('div');
            divDatos.classList.add("product-data");

            let nombre = document.createElement("div");
            nombre.textContent = datos['product'];
            nombre.classList.add("product-name");

            let precio = document.createElement("div");
            precio.textContent = (datos['price'] / 100) + "€/kg";
            precio.classList.add("price");

            let botonCompra = document.createElement("button");
            botonCompra.textContent = "Añadir";
            botonCompra.classList.add("botonCompra");
            botonCompra.setAttribute("data-id",datos['id']);
            
            divProducto.append(foto);
            divDatos.append(nombre);
            divDatos.append(precio);
            divDatos.append(botonCompra);
            divProducto.append(divDatos);
            divSeccionProductos.prepend(divProducto)

            botonCompra.addEventListener('click',(e)=>{
                let id = botonCompra.getAttribute("data-id");
                // carro = Object.assign(carro,);
                let añadirProducto = true;
                carro.forEach(element => {
                    if(element['id'] == id){
                        element['cant']++;
                        añadirProducto = false;
                    }
                });

                if(añadirProducto){
                    let fruta = {
                        ...listProducts.find(item => item['id'] == id),
                        cant: 1,
                    };
                    carro.push(fruta);
                }
                carrito(datos);
            });

        }
        
        //crea el carrito
        function carrito(datos) {
            let divCarrito = document.getElementById("cart-section");
            while (divCarrito.firstChild){
                divCarrito.removeChild(divCarrito.firstChild);
            };

            let titulo = document.createElement("h1");
            titulo.textContent = "Carrito";

            let table = document.createElement("table");
            table.classList.add("tabla");
            let tr = document.createElement("tr");
            let cant = document.createElement("th");
            cant.textContent = "Cant.";
            let producto = document.createElement("th");
            producto.textContent = "Producto";
            let precio = document.createElement("th");
            precio.textContent = "Precio";

            divCarrito.append(titulo);
            tr.append(cant);
            tr.append(producto);
            tr.append(precio);
            table.append(tr);
            divCarrito.append(table);

            let total = 0;
            carro.forEach(element => {
                let tr2 = document.createElement("tr");
                let cant2 = document.createElement("td");
                cant2.textContent = element['cant'];
                let producto2 = document.createElement("td");
                producto2.textContent = element['product'];
                let precio2 = document.createElement("td");
                let cant =  (element['cant']*(element['price'] / 100)).toFixed(2);
                precio2.textContent =  cant + "€";
                total += parseFloat(cant);
                
                tr2.append(cant2);
                tr2.append(producto2);
                tr2.append(precio2);
                table.append(tr2);
            });
            let tr3 = document.createElement("tr");
            let th = document.createElement("th");
            th.setAttribute("colspan", "2");
            th.textContent = 'Total: ';
            let th2 = document.createElement("th");
            th2.textContent = total.toFixed(2) + "€";
            tr3.append(th);
            tr3.append(th2);
            table.append(tr3);

           }
        
        //Mostrar todas las frutas
        function createProducts() {
            while (divSeccionProductos.firstChild && divSeccionProductos.firstChild != div ){
                divSeccionProductos.removeChild(divSeccionProductos.firstChild);
            };
            listProducts.filter((item,index) => {
            if(index/8 >= (pagina-1) && index/8 < pagina){
                return true;
            }else{
                return false;
            }
            }).forEach(element => {
                createProduct(element);
            });
        }
        createProducts();
    </script>
</body>
</html>